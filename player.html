<div class="panel">
<div class="type" style="left: 7%"><p align="center">-</p></div>
<div class="type" style="left: 80%;color: #de5252;background: #ff6d6d;"><p align="center">-</p></div>
</div>
<div class="window">
<p align="center">Settings</p>
<p align="center">
<input type="number" id="width" min='5' placeholder="width"/>
</p>
<p align="center">
<input type="number" id="height" min='5' placeholder="height"/>
</p>
<p align="center">
<input type="number" id="length" placeholder="length"/>
</p>
<p align="center">
<textarea id="cities" placeholder="cities"></textarea>
</p>
<p align="center">
<select >
<option disabled selected>Mode</option>
<option value='1'>1</option>
<option value='2'>2</option>
<option value='3'>3</option>
</select>
</p>
<p align="center">
<textarea id="mountain" placeholder="mountains"></textarea>
</p>
<p align="center">
<textarea id="water" placeholder="water"></textarea>
</p>
<p align="center">
<select>
<option disabled selected>Choose Oponent</option>
<option value="player">player</option>
<option value="1">Computer 1</option>
<option value="2">Computer 2</option>
<option value="3">Computer 3</option>
</select>
</p>
<p align="center"><button class="but" onClick="commit(this)">ok</button></p>
</div>
<div class="lio"><button class="but ou" style="width: 5%" onClick="save(this)">See</button><button class="but ou" style="width: 5%;background: lightblue">Download</button></div>
<script type="text/javascript">
var fi = 0;
var conts = [];
</script>
<script src="crafty.js"></script>

<script>
var op;
var mode;
var max = 0;
var turn = 0;
var cities;
var city = [];
Se = {
h: 83,
w: 102,
width: 5,
height: 5
}
img1 = "water_plate.png";
city[1] = {};
city[1].x = 1;
city[1].y = 3;
city[1].count = 0;
city[1].img = "water_plate.png";
city[1].self = "city.png";
city[1].id = 1;
city[2] = {};
city[2].x = 3;
city[2].y = 1;
city[2].count = 0;
city[2].img = "plate_red.png";
city[2].self = "city.png";
city[2].id = 2;
var tower = [];
var t_num = 0;
var img = [];
var n;
var border = 1;
window.count = function() {
	city[1].count=0;
	city[2].count=0;
	for(var j=1;j<Se.width+1;j++) {
		for(var i=1;i<Se.height+1;i++) {
		if(img[j][i].owner==city[1].id) {
			city[1].count++;
		   }
		   if(img[j][i].owner==city[2].id) {
			city[2].count++;
		   }
	    }
	}
	document.getElementsByClassName("type")[0].children[0].innerHTML = city[1].count;
	document.getElementsByClassName("type")[1].children[0].innerHTML = city[2].count;
}
window.draw_city = function(city) {
	if(img[city.x][city.y]) {
img[city.x][city.y].image(city.img);
img[city.x][city.y].owner = city.id;
if(img[city.x+1]){
if(img[city.x+1][city.y]){
	if(img[city.x+1][city.y].type!="city"){
img[city.x+1][city.y].image(city.img);
img[city.x+1][city.y].owner = city.id;
}
}
}
if(img[city.x]){
if(img[city.x][city.y+1]) {
	if(img[city.x][city.y+1].type!="city"){
img[city.x][city.y+1].image(city.img);
img[city.x][city.y+1].owner = city.id;
}
}
}
if(img[city.x]){
if(img[city.x][city.y-1]) {
	if(img[city.x][city.y-1].type!="city"){
img[city.x][city.y-1].image(city.img);
img[city.x][city.y-1].owner = city.id;
}
}
if(img[city.x-1]){
if(img[city.x-1][city.y]) {
if(img[city.x-1][city.y].type!="city"){
img[city.x-1][city.y].image(city.img);
img[city.x-1][city.y].owner = city.id;
}
}
}
if(img[city.x][city.y].odd==2){
if(img[city.x-1]) {
	if(img[city.x-1][city.y-1]) {
		if(img[city.x-1][city.y-1].type!="city"){
img[city.x-1][city.y-1].image(city.img);
img[city.x-1][city.y-1].owner = city.id;
}
 		}
	}
	if(img[city.x+1]) {
if(img[city.x+1][city.y-1]) {
if(img[city.x+1][city.y-1].type!="city"){
img[city.x+1][city.y-1].image(city.img);
img[city.x+1][city.y-1].owner = city.id;
}
	}
}
}
else if(img[city.x][city.y].odd==1) {
if(img[city.x-1]) {
	if(img[city.x-1][city.y+1]) {
		if(img[city.x-1][city.y+1].type!="city"){
img[city.x-1][city.y+1].image(city.img);
img[city.x-1][city.y+1].owner = city.id;
}
 		}
	}
if(img[city.x+1]) {
if(img[city.x+1][city.y+1]) {
	if(img[city.x+1][city.y+1].type!="city"){
img[city.x+1][city.y+1].image(city.img);
img[city.x+1][city.y+1].owner = city.id;
}
	}
}
	}
}
}
}
function engine() {
	for(var j=1;j<Se.width+1;j++) {
		for(var i = 0;i<Se.height+1;i++) {
			if(img[j]) {
				if(img[j][i]) {
			if(goes(2,1,j+" "+i,1)!=null){
				return img[j][i];
			}
			}
			}
		}
	}
}
window.draw_all = function(he,wi) {
	for(var j = 1;j<wi+1;j++) {
		img[j] = [];
		tower[j] = [];

if(j%2!=0) {
n = 2;
}
else {
	n = 1;
}
	for(var i =1;i<he+1;i++)	{
			 img[j][i] = Crafty.e("2D, DOM, Image, Mouse")
               .attr({ w: Se.w, h: Se.h, x: Se.w*j/1.5 , y: Se.h*i+Se.h/n,odd: n,type: "usual",owner: 0,bn: j,bm: i})
                .image("plate.png")
                .bind('Click',function(e) {
                	if(turn<max*2) {
                	if(turn%2==0) {
                	if(goes(1,1,this.bn+" "+this.bm,2)!=null){
                		conts[turn] = this.bn+" "+this.bm;
                		turn++;

                		if(op!="player") {
                			f = engine();
                			conts[turn] = f.bn+" "+f.bm;
                			turn++;
                			window.count();
                		}
                	}

                }
                else {
                	if(goes(2,1,this.bn+" "+this.bm,1)!=null) {
                		conts[turn] = this.bn+" "+this.bm;
                		turn++;
                		window.count();
                	}
                }
                }
                });
		} 
	}
		window.draw_city(city[1]);
              window.draw_city(city[2]);
              window.set_city(city[1].x,city[1].y,1);
              window.set_city(city[2].x,city[2].y,2);
}
window.set_tower = function(x,y) {
	var flei;
	if(img[x][y].odd==1){flei=1;}else{flei=2;}
	if(tower[x][y]){return false;}
	tower[x][y] = Crafty.e("2D, DOM, Image, Tween")
               .attr({ w: Se.w, h: Se.h, x: Se.w*x/1.5, y: Se.h*y+Se.h/flei,type: "tower"})
                .image("tower.png")
                t_num++;
}
window.set_city = function(x,y,owner) {
	var flei;
	if(img[x][y].odd==1){flei=1;}else{flei=2;}
	img[x][y].type = "city";
	Crafty.e("2D, DOM, Image")
               .attr({ w: Se.w, h: Se.h, x: Se.w*x/1.5, y: Se.h*y+Se.h/flei,type: "city"})
                .image(city[owner].self);
}
window.stay_tower = function(x,y,owner) {	
window.set_tower(x,y);
window.draw_city({x:x,y:y,img: city[owner].img,id: owner});
}
window.set_mountain = function(mou) {
aa = mou.split(' ');
counnt = parseInt(aa[0]);
for(var i = 1;i<(counnt*2)+1;i+=2) {
img[parseInt(aa[i])][parseInt(aa[i+1])].type="mountain";
img[parseInt(aa[i])][parseInt(aa[i+1])].image("mountain.png");
}
}
window.set_water = function(mou) {
aa = mou.split(' ');
counnt = parseInt(aa[0]);
for(var i = 1;i<(counnt*2)+1;i+=2) {
img[parseInt(aa[i])][parseInt(aa[i+1])].type="water";
img[parseInt(aa[i])][parseInt(aa[i+1])].image("water.png");
}
}
window.read_s = function(co) {

}
window.read_u = function(co,fg) {
	var ab;
if(co%2==0) {ab = goes(1,co,fg,2);}
else{ab = goes(2,co,fg,1);}
if(ab!=null){co--;fg++;window.read_u(co,fg);}
}
window.cmd = {}
	window.cmd.init = function() {
		
}
var goes = function(a,b,fg,d) {
	if(b==0) {
	return null;
		}
		else {
	c = fg.split(' ');
	console.log(fg);
	if(parseInt(c[0])==city[1].x & parseInt(c[1])==city[1].y) {
		console.log("Sorry there is a city");
		return null;
	}
	if(img[parseInt(c[0])][parseInt(c[1])].owner==d) {
		console.log("Invalid value");
		return null;
	}
	if(img[parseInt(c[0])][parseInt(c[1])].type=="water"|"mountain") {
		console.log("Mountain or water");
		return null;
	}
	 if(img[parseInt(c[0])][parseInt(c[1])].owner==0) {
		if(check_pos(parseInt(c[0]),parseInt(c[1]),a)!=true){
			console.log("Validate move");
return null;
}
	}
	if(tower[parseInt(c[0])]){
		if(tower[parseInt(c[0])][parseInt(c[1])]) {
			console.log('There is a tower.');
			return null;
		}
	}
	window.stay_tower(parseInt(c[0]),parseInt(c[1]),a);
	return true;
        }
    }
window.onload = function() {
	Crafty.init();
	window.cmd.init();
};
function check_pos(x,y,a) {
	if(img[x][y]) {

if(img[x+1]){
if(img[x+1][y]){
if(img[x+1][y].owner==a){
return true;
}
}
}
if(img[x]){
if(img[x][y+1]) {
if(img[x][y+1].owner==a) {
return true;
}
}
}
if(img[x]){
if(img[x][y-1]) {
	if(img[x][y-1].owner==a) {
	return true;

}
}
}
if(img[x-1]){
if(img[x-1][y]) {
if(img[x-1][y].owner==a) {
return true;
}
}
}
if(img[x][y].odd==2){
if(img[x-1]) {
	if(img[x-1][y-1]) {
if(img[x-1][y-1].owner==a) {
return true;
 		}
 		}
	}
	if(img[x+1]) {
if(img[x+1][y-1]) {

if(img[x+1][y-1].owner==a) {
return true;
	}
	}
}
}
else if(img[x][y].odd==1) {
if(img[x-1]) {
	if(img[x-1][y+1]) {
if(img[x-1][y+1].owner==a) {
return true;
 		}
 		}
	}
if(img[x+1]) {
if(img[x+1][y+1]) {
if(img[x+1][y+1].owner==a) {
return true;
	}
	}
}
	}
}
else {
	return false;
}
}
function commit(obec) {
		max = parseInt(obec.parentNode.parentNode.children[3].children[0].value);
	cities = obec.parentNode.parentNode.children[4].children[0].value;
	mode =  parseInt(obec.parentNode.parentNode.children[5].children[0].value);
	mount = obec.parentNode.parentNode.children[6].children[0].value;
	water = obec.parentNode.parentNode.children[7].children[0].value;
	op = obec.parentNode.parentNode.children[8].children[0].value;
	ci = cities.split(' ');
	city[1].x = parseInt(ci[0]);city[1].y = parseInt(ci[1]);
	city[2].x = parseInt(ci[2]);city[2].y = parseInt(ci[3]);
	document.getElementById("cr-stage").setAttribute("class","bd");
	window.draw_all(parseInt(obec.parentNode.parentNode.children[2].children[0].value),parseInt(obec.parentNode.parentNode.children[1].children[0].value));
	if(mode>1) {
	window.set_water(water);
	window.set_mountain(mount);
}
	var ent = Crafty.e('2D, DOM').attr({x: 250, y: 250, w: 100, h: 100});
	Crafty.viewport.follow(ent,3000);
	obec.parentNode.parentNode.parentNode.removeChild(obec.parentNode.parentNode);
	Se.width = parseInt(obec.parentNode.parentNode.children[2].children[0].value);
	Se.height = parseInt(obec.parentNode.parentNode.children[1].children[0].value);

}
function save(th) {
	var line = [];
	n = 0;
 line[n] = Se.width+" "+Se.height+" "+max+" "+mode;
n++;
 line[n] = cities;
if(mode>1) {
	n++;
	line[n] = mount;
	n++;
	line[n] = water;
}
n++;
var gip = "";
for(var i=0;i<conts.length;i++){
gip+=conts[i]+"\r\n";
}
var sip="";
for(var j=0;j<line.length;j++){
sip+=line[j]+"\r\n";
}
alert(conts[0]);
//var file = new Blob([escape(sip+gip)], {type: "text/plain"});
th.parentNode.children[1].innerHTML="<a href='data:text/csv;charset=utf-8,"+escape(sip+gip)+"'download='output.txt'>Download</a>";
}
</script>
<style>
* {
	-webkit-box-selection: none;
}
.window {
	position: fixed;
	transition: 1s;
	width: 500px;
	height: 600px;
	background: white;
	left: 36%;
	-webkit-animation: anim 1s;
	z-index: 100;
	box-shadow: 1px 1px 10px lightgrey;
	top: 0px;
}
.but {
	width: 70%;
	height: 40px;
	background: orange;
	border-radius: 8px;
	color: #796e58;
	border: none;
	font-size: 15px;
	transition: 0.5s;
	margin-left: 10px;
	margin-bottom: 5px;
	margin-top: 5px;
}
.q:hover .but {
	background: #ffcc6d;
	width: 90%;
}
.but:hover {
	background: #ffcc6d;
	width: 90%;
}
input {
	width: 70%;
	height: 40px;
	text-align: center;
}
select {
	width: 70%;
	height: 40px;
	text-align: center;
}
.bd {
-webkit-animation: anims 0.5s;
}
@-webkit-keyframes anim {
	0% {
		top: -200px;
	}
	100% {
		top: 0;
	}
}
@-webkit-keyframes anims {
	0% {
		margin-top: -1000px;
	}
	100% {
		margin-top: 0;
	}
}
.panel {
	width: 100%;
    height: 150px;
    background: rgba(241, 241, 241, 0.44);
    opacity: 1;
    position: fixed;
    font-size: 40px;
    top: 0;
    display: inline-block;
    z-index: 100;
}
.type {
    position: absolute;
    color: #84bbb1;
    width: 200px;
    height: 150px;
    font-size: 60px;
    background: #b8e0db;
    opacity: 1;
    display: inline-block;
    font-family: Arial;
}
textarea {
	width: 70%;
}
.lio {
	position:fixed;
	bottom: 0;
	width: 100%;
	z-index: 10;
	background: rgba(232, 232, 232, 0.44);
}
.ou {
	width: 50px;
}
body {
	margin: 0;
}
</style>
